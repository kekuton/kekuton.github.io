<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="theme-color" content="#6366f1">
<title>üß† ZUMER BRAIN</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  touch-action: manipulation;
}
:root {
  --primary: #6366f1;
  --secondary: #8b5cf6;
  --accent: #ec4899;
  --bg-dark: #0f172a;
  --bg-card: #1e293b;
  --text-light: #f8fafc;
  --text-gray: #94a3b8;
  --success: #22c55e;
  --danger: #ef4444;
  --warning: #f59e0b;
  --border-radius: 24px;
  --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
}
body {
  background: linear-gradient(135deg, var(--bg-dark), #1e293b);
  color: var(--text-light);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 20px;
  overflow-x: hidden;
  position: relative;
  -webkit-overflow-scrolling: touch;
}
.container {
  width: 100%;
  max-width: 420px;
  background: var(--bg-card);
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  overflow: hidden;
  position: relative;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}
.header {
  padding: 24px 20px;
  text-align: center;
  background: linear-gradient(135deg, #1e293b, #0f172a);
  position: relative;
  flex-shrink: 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.header h1 {
  font-size: 28px;
  font-weight: 800;
  background: linear-gradient(90deg, #8b5cf6, #ec4899, #6366f1);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}
.header p {
  font-size: 15px;
  color: var(--text-gray);
  opacity: 0.9;
}
.screen {
  display: none;
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 20px;
}
.screen.active {
  display: flex;
  flex-direction: column;
}
/* Age Warning */
.age-warning {
  background: rgba(239, 68, 68, 0.15);
  border-left: 4px solid var(--danger);
  padding: 16px;
  margin: 20px;
  border-radius: 16px;
  display: none;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}
.age-warning.show {
  display: block;
}
/* Theme Selection */
.theme-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  padding: 0 20px;
  flex: 1;
}
.theme-card {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 20px;
  padding: 24px 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(5px);
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  touch-action: manipulation;
}
.theme-card:hover, .theme-card:active {
  transform: translateY(-6px);
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4);
  border-color: rgba(255, 255, 255, 0.2);
}
.theme-icon {
  font-size: 36px;
  margin-bottom: 14px;
  display: block;
  transition: transform 0.3s ease;
}
.theme-card:hover .theme-icon {
  transform: scale(1.2);
}
.theme-title {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 8px;
  color: white;
}
.theme-desc {
  font-size: 12px;
  color: var(--text-gray);
  line-height: 1.4;
  opacity: 0.85;
}
.theme-card.adult::after {
  content: "18+";
  position: absolute;
  top: 14px;
  right: 14px;
  background: var(--accent);
  color: white;
  font-size: 11px;
  font-weight: 800;
  padding: 5px 12px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
}
/* Game Screen */
.game-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  background: rgba(0, 0, 0, 0.2);
  flex-shrink: 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.timer-box {
  background: rgba(236, 72, 153, 0.15);
  padding: 10px 20px;
  border-radius: 16px;
  font-size: 22px;
  font-weight: 800;
  color: #ec4899;
  border: 1px solid rgba(236, 72, 153, 0.3);
}
.stats-row {
  display: flex;
  justify-content: space-around;
  padding: 16px 20px;
  background: rgba(0, 0, 0, 0.2);
  font-size: 14px;
  flex-shrink: 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.stat {
  text-align: center;
}
.stat-value {
  font-weight: 800;
  font-size: 20px;
  color: var(--primary);
  margin-bottom: 4px;
}
.card-area {
  padding: 24px 20px;
  min-height: 240px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex: 1;
}
.card {
  width: 100%;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 22px;
  padding: 28px;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
}
.card-category {
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  color: white;
  font-size: 13px;
  font-weight: 800;
  padding: 8px 20px;
  border-radius: 50px;
  display: inline-block;
  margin-bottom: 20px;
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
}
.card-question {
  font-size: 20px;
  line-height: 1.5;
  margin-bottom: 24px;
  font-weight: 600;
}
.answer-buttons {
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
  padding: 0 20px 20px;
  flex-shrink: 0;
}
.btn-answer {
  padding: 18px;
  border: none;
  border-radius: 18px;
  font-size: 17px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
  touch-action: manipulation;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  -webkit-tap-highlight-color: transparent;
}
.btn-answer.correct {
  background: linear-gradient(135deg, #22c55e, #16a34a);
  color: white;
}
.btn-answer.incorrect {
  background: linear-gradient(135deg, #ef4444, #dc2626);
  color: white;
}
.btn-answer:hover:not(:disabled) {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}
.btn-answer:active {
  transform: scale(0.98);
}
.controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  padding: 20px;
  flex-shrink: 0;
}
.btn-control {
  padding: 16px;
  border: none;
  border-radius: 18px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-light);
  transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.btn-control:hover {
  background: rgba(255, 255, 255, 0.18);
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}
.btn-control.primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
}
.btn-control.primary:hover {
  box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
}
/* Result Screen */
.result-container {
  padding: 32px 24px;
  text-align: center;
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.result-icon {
  font-size: 72px;
  margin: 24px 0;
  text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
}
.result-title {
  font-size: 28px;
  font-weight: 800;
  margin-bottom: 20px;
  background: linear-gradient(90deg, #8b5cf6, #ec4899);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.rating-badge {
  background: linear-gradient(135deg, var(--accent), var(--secondary));
  color: white;
  padding: 12px 28px;
  border-radius: 50px;
  display: inline-block;
  font-weight: 800;
  margin: 24px 0;
  font-size: 18px;
  box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
}
.result-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin: 28px 0;
  width: 100%;
}
.stat-box {
  background: rgba(255, 255, 255, 0.08);
  padding: 20px;
  border-radius: 20px;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.1);
}
.stat-box-value {
  font-size: 24px;
  font-weight: 800;
  color: var(--primary);
  margin-bottom: 8px;
  text-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
}
.stat-box-label {
  font-size: 13px;
  color: var(--text-gray);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  opacity: 0.85;
}
/* Modals */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 23, 42, 0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}
.modal.active {
  opacity: 1;
  pointer-events: auto;
}
.modal-content {
  background: var(--bg-card);
  border-radius: 24px;
  padding: 28px;
  width: 90%;
  max-width: 380px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  max-height: 90vh;
  overflow-y: auto;
}
/* Notification */
.notification {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(120px);
  background: rgba(30, 41, 59, 0.95);
  color: white;
  padding: 16px 24px;
  border-radius: 20px;
  font-weight: 700;
  z-index: 999;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
  transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(255, 255, 255, 0.15);
}
.notification.show {
  transform: translateX(-50%) translateY(0);
}
/* Footer icons */
.footer-icons {
  position: fixed;
  bottom: 24px;
  right: 24px;
  display: flex;
  gap: 16px;
  z-index: 100;
}
.icon-btn {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.15);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
  transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.icon-btn:hover {
  background: rgba(255, 255, 255, 0.25);
  transform: translateY(-4px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}
.icon-btn:active {
  transform: scale(0.95);
}
/* Progress bar */
.progress-container {
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  margin: 0 20px;
  border-radius: 4px;
  overflow: hidden;
  flex-shrink: 0;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  border-radius: 4px;
  transition: width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
/* Difficulty selector */
.difficulty-selector {
  display: flex;
  justify-content: center;
  gap: 12px;
  padding: 0 20px 20px;
  flex-shrink: 0;
}
.diff-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-gray);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  border: 1px solid rgba(255, 255, 255, 0.15);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.diff-btn.active {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border: none;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
}
.diff-btn:hover:not(.active) {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-2px);
}
/* Authors section */
.authors-section {
  padding: 20px;
  text-align: center;
  background: rgba(0, 0, 0, 0.2);
  margin-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  flex-shrink: 0;
}
.authors-title {
  font-size: 14px;
  color: var(--text-gray);
  margin-bottom: 12px;
  font-weight: 600;
}
.author-links {
  display: flex;
  justify-content: center;
  gap: 16px;
}
.author-link {
  background: rgba(255, 255, 255, 0.12);
  padding: 10px 20px;
  border-radius: 18px;
  color: var(--text-light);
  text-decoration: none;
  font-size: 15px;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  display: flex;
  align-items: center;
  gap: 8px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
.author-link:hover, .author-link:active {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
}
/* Profile Section */
.profile-section {
  display: flex;
  align-items: center;
  padding: 20px;
  background: rgba(0, 0, 0, 0.2);
  margin: 20px;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}
.profile-avatar {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  margin-right: 16px;
  cursor: pointer;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
}
.profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
}
.profile-info {
  flex: 1;
}
.profile-name {
  font-weight: 700;
  font-size: 17px;
  margin-bottom: 4px;
}
.profile-level {
  font-size: 13px;
  color: var(--text-gray);
}
/* Scroll indicator */
.scroll-indicator {
  position: absolute;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  width: 36px;
  height: 36px;
  border: 2px solid var(--text-gray);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.8;
  animation: bounce 2s infinite;
  z-index: 50;
}
@keyframes bounce {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(8px); }
}
.scroll-indicator i {
  font-size: 18px;
}
/* Ripple Effect */
.ripple {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.6);
  transform: scale(0);
  animation: ripple 0.6s linear;
}
@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}
</style>
</head>
<body>
<!-- Confetti container -->
<div id="confetti-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></div>
<!-- Scroll indicator -->
<div class="scroll-indicator" id="scroll-indicator">
<i class="fas fa-chevron-down"></i>
</div>
<!-- Footer Icons -->
<div class="footer-icons">
<div class="icon-btn" id="sound-toggle">
<i class="fas fa-volume-up"></i>
</div>
<div class="icon-btn" id="achievements-toggle">
<i class="fas fa-trophy"></i>
</div>
<div class="icon-btn" id="leaderboard-toggle">
<i class="fas fa-crown"></i>
</div>
<div class="icon-btn" id="profile-toggle">
<i class="fas fa-user"></i>
</div>
</div>
<!-- Notification -->
<div class="notification" id="notification">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç! +10 –æ—á–∫–æ–≤</div>
<!-- Achievements Modal -->
<div class="modal" id="achievements-modal">
<div class="modal-content">
<h3 style="text-align: center; margin-bottom: 24px; font-size: 22px; font-weight: 800;">
<i class="fas fa-trophy"></i> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
</h3>
<div id="achievements-list" style="max-height: 240px; overflow-y: auto;"></div>
<button class="btn-control" style="margin-top: 24px;" id="close-achievements">
–ó–∞–∫—Ä—ã—Ç—å
</button>
</div>
</div>
<!-- Leaderboard Modal -->
<div class="modal" id="leaderboard-modal">
<div class="modal-content">
<h3 style="text-align: center; margin-bottom: 24px; font-size: 22px; font-weight: 800;">
<i class="fas fa-crown"></i> –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
</h3>
<div id="leaderboard-list" style="max-height: 240px; overflow-y: auto;"></div>
<div style="margin-top: 16px; text-align: center; font-size: 14px; color: var(--text-gray);">
–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ø—Ä–∏–∑: 1000 –º–æ–Ω–µ—Ç üèÜ
</div>
<button class="btn-control" style="margin-top: 24px;" id="close-leaderboard">
–ó–∞–∫—Ä—ã—Ç—å
</button>
</div>
</div>
<!-- Profile Modal -->
<div class="modal" id="profile-modal">
<div class="modal-content">
<h3 style="text-align: center; margin-bottom: 24px; font-size: 22px; font-weight: 800;">
<i class="fas fa-user"></i> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
</h3>
<div style="text-align: center; margin-bottom: 24px;">
<div class="profile-avatar" id="profile-avatar">
<img src="" alt="Avatar" id="profile-avatar-img" style="display: none;">
<span id="profile-avatar-fallback">üß†</span>
</div>
<h4 id="profile-display-name" style="margin: 16px 0; font-weight: 800; font-size: 20px;">–ó—É–º–µ—Ä</h4>
<div style="display: flex; justify-content: center; gap: 20px; margin: 16px 0;">
<div style="text-align: center;">
<div style="font-weight: 800; color: var(--primary); font-size: 20px;" id="profile-level">1</div>
<div style="font-size: 13px; color: var(--text-gray);">–£—Ä–æ–≤–µ–Ω—å</div>
</div>
<div style="text-align: center;">
<div style="font-weight: 800; color: var(--accent); font-size: 20px;" id="profile-coins">100</div>
<div style="font-size: 13px; color: var(--text-gray);">–ú–æ–Ω–µ—Ç—ã</div>
</div>
<div style="text-align: center;" id="premium-indicator" style="display: none;">
<div style="font-weight: 800; color: gold; font-size: 20px;">‚≠ê</div>
<div style="font-size: 13px; color: gold;">Premium</div>
</div>
</div>
</div>
<div style="margin-bottom: 24px;">
<h4 style="margin-bottom: 16px; font-weight: 800;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
<div style="background: rgba(255,255,255,0.08); padding: 16px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.1);">
<div style="font-weight: 800; color: var(--success); font-size: 18px;" id="profile-accuracy">85%</div>
<div style="font-size: 12px; color: var(--text-gray); margin-top: 6px;">–¢–æ—á–Ω–æ—Å—Ç—å</div>
</div>
<div style="background: rgba(255,255,255,0.08); padding: 16px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.1);">
<div style="font-weight: 800; color: var(--accent); font-size: 18px;" id="profile-streak">5</div>
<div style="font-size: 12px; color: var(--text-gray); margin-top: 6px;">–°–µ—Ä–∏—è</div>
</div>
</div>
</div>
<button class="btn-control" id="close-profile">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
<!-- Share Modal -->
<div class="modal" id="share-modal">
<div class="modal-content">
<h3 style="text-align: center; margin-bottom: 24px; font-size: 22px; font-weight: 800;">
<i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
</h3>
<div style="text-align: center; margin-bottom: 24px;">
<div style="font-size: 52px; margin: 20px 0;">üèÜ</div>
<p style="margin-bottom: 20px; font-size: 18px; font-weight: 600;">–Ø –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ <strong>95%</strong> –≤–æ–ø—Ä–æ—Å–æ–≤!</p>
<p style="color: var(--text-gray); font-size: 15px; margin-bottom: 28px;">–ü–æ–ø—Ä–æ–±—É–π –∏ —Ç—ã –≤ ZUMER BRAIN!</p>
</div>
<div class="btn-control primary" id="share-to-telegram" style="padding: 18px;">
<i class="fab fa-telegram-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram
</div>
<button class="btn-control" style="margin-top: 16px;" id="close-share">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
<!-- Multiplayer Modal -->
<div class="modal" id="multiplayer-modal">
<div class="modal-content">
<h3 style="text-align: center; margin-bottom: 24px; font-size: 22px; font-weight: 800;">
<i class="fas fa-users"></i> –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä
</h3>
<div style="margin: 20px 0;">
<button class="btn-control primary" id="duel-btn" style="margin-bottom: 12px; width: 100%;">
<i class="fas fa-user-friends"></i> –î—É—ç–ª—å 1vs1
</button>
<button class="btn-control" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); width: 100%; margin-bottom: 12px;">
<i class="fas fa-users"></i> –ö–æ–º–∞–Ω–¥–∞ 2vs2
</button>
<button class="btn-control" style="background: linear-gradient(135deg, #ec4899, #db2777); width: 100%;">
<i class="fas fa-trophy"></i> –¢—É—Ä–Ω–∏—Ä
</button>
</div>
<div style="text-align: center; margin: 16px 0; font-size: 14px; color: var(--text-gray);">
–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞ –∏–ª–∏ –Ω–∞–π–¥–∏—Ç–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
</div>
<button class="btn-control" id="close-multiplayer">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
<!-- Study Mode Modal -->
<div class="modal" id="study-modal">
<div class="modal-content">
<h3 style="text-align: center; margin-bottom: 24px; font-size: 22px; font-weight: 800;">
<i class="fas fa-book"></i> –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è
</h3>
<div style="background: rgba(34, 197, 94, 0.15); border-left: 4px solid var(--success); padding: 16px; border-radius: 16px; margin-bottom: 24px;">
<h4 style="margin-bottom: 12px; font-weight: 700; color: var(--success);">–ë–µ–∑ —Ç–∞–π–º–µ—Ä–∞ ‚Ä¢ –° –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏</h4>
<p style="font-size: 15px; line-height: 1.6; color: var(--text-gray);">
–£—á–∏—Ç–µ—Å—å –≤ —Å–≤–æ–µ–º —Ç–µ–º–ø–µ! –ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º.
</p>
</div>
<div style="margin: 20px 0;">
<h4 style="margin-bottom: 16px; font-weight: 800;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è</h4>
<div class="theme-grid" style="grid-template-columns: 1fr; gap: 16px;">
<div class="theme-card" data-study="tiktok">
<i class="fab fa-tiktok theme-icon"></i>
<div class="theme-title">TikTok</div>
<div class="theme-desc">–¢—Ä–µ–Ω–¥—ã –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</div>
</div>
<div class="theme-card" data-study="memes">
<i class="fas fa-laugh-squint theme-icon"></i>
<div class="theme-title">–ú–µ–º—ã</div>
<div class="theme-desc">–í–∏—Ä—É—Å–Ω—ã–µ —à—É—Ç–∫–∏</div>
</div>
<div class="theme-card" data-study="music">
<i class="fas fa-music theme-icon"></i>
<div class="theme-title">–ú—É–∑—ã–∫–∞</div>
<div class="theme-desc">–•–∏—Ç—ã –∏ –∞—Ä—Ç–∏—Å—Ç—ã</div>
</div>
<div class="theme-card" data-study="slang">
<i class="fas fa-comment-dots theme-icon"></i>
<div class="theme-title">–°–ª–µ–Ω–≥</div>
<div class="theme-desc">–ö—Ä–∏–Ω–∂, –≤–∞–π–±, —Ä–æ—Ñ–ª</div>
</div>
</div>
</div>
<button class="btn-control" id="close-study">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
<!-- Invite Modal -->
<div class="modal" id="invite-modal">
<div class="modal-content">
<h3 style="text-align:center; margin-bottom:20px; font-size:22px; font-weight:800;">
üîó –û—Ç–ø—Ä–∞–≤—å –¥—Ä—É–≥—É!
</h3>
<p style="text-align:center; color:var(--text-gray); margin-bottom:16px; font-size:14px;">
–°–∫–æ–ø–∏—Ä—É–π —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å –≤ Telegram
</p>
<input type="text" id="invite-input" readonly style="width:100%; padding:12px; border-radius:12px; background:rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2); margin:12px 0;">
<button class="btn-control primary" id="copy-link-btn" style="width:100%;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="btn-control" id="close-invite" style="margin-top:12px; width:100%;">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>
</div>
<!-- Theme Selection Screen -->
<div class="container screen active" id="screen-theme">
<div class="header">
<h1>üß† ZUMER BRAIN</h1>
<p>–¢–µ—Å—Ç –Ω–∞ –∑—É–º–µ—Ä—Å–∫—É—é —ç—Ä—É–¥–∏—Ü–∏—é</p>
</div>
<!-- Profile Section -->
<div class="profile-section">
<div class="profile-avatar" id="main-profile-avatar">
<img src="" alt="Avatar" id="main-profile-avatar-img" style="display: none;">
<span id="main-profile-avatar-fallback">üß†</span>
</div>
<div class="profile-info">
<div class="profile-name" id="main-profile-name">–ó—É–º–µ—Ä</div>
<div class="profile-level">–£—Ä–æ–≤–µ–Ω—å <span id="main-profile-level">1</span></div>
</div>
</div>
<!-- Multiplayer Button -->
<div style="padding: 0 20px 20px;">
<button class="btn-control primary" id="open-multiplayer" style="width: 100%;">
<i class="fas fa-users"></i> –ò–≥—Ä–∞—Ç—å —Å –¥—Ä—É–∑—å—è–º–∏
</button>
</div>
<!-- Study Mode Button -->
<div style="padding: 0 20px 20px;">
<button class="btn-control" style="background: linear-gradient(135deg, var(--success), #16a34a); width: 100%;" id="open-study">
<i class="fas fa-book"></i> –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è
</button>
</div>
<div class="age-warning" id="age-warning">
<i class="fas fa-exclamation-triangle"></i> –ö–æ–Ω—Ç–µ–Ω—Ç 18+
</div>
<!-- Daily Challenges -->
<div style="padding: 0 20px 20px;">
<h4 style="margin: 20px 0 16px; font-weight: 800; padding-left: 4px;">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h4>
<div style="background: rgba(255,255,255,0.08); border-radius: 18px; padding: 18px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.1);">
<div style="font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
<i class="fas fa-music" style="color: var(--primary);"></i> –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –≥–µ–Ω–∏–π
</div>
<div style="font-size: 14px; color: var(--text-gray); margin-bottom: 12px;">–û—Ç–≤–µ—Ç—å –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –º—É–∑—ã–∫—É</div>
<div style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-bottom: 12px; overflow: hidden;">
<div style="height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary)); border-radius: 4px; width: 60%;"></div>
</div>
<div style="font-size: 14px; color: var(--success); font-weight: 700;">+25 –º–æ–Ω–µ—Ç ü™ô</div>
</div>
<div style="background: rgba(255,255,255,0.08); border-radius: 18px; padding: 18px; border: 1px solid rgba(255,255,255,0.1);">
<div style="font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 10px;">
<i class="fas fa-fire" style="color: var(--accent);"></i> –û–≥–Ω–µ–Ω–Ω–∞—è —Å–µ—Ä–∏—è
</div>
<div style="font-size: 14px; color: var(--text-gray); margin-bottom: 12px;">10 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥—Ä—è–¥</div>
<div style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-bottom: 12px; overflow: hidden;">
<div style="height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary)); border-radius: 4px; width: 30%;"></div>
</div>
<div style="font-size: 14px; color: var(--success); font-weight: 700;">+50 –º–æ–Ω–µ—Ç ü™ô</div>
</div>
</div>
<div class="difficulty-selector">
<button class="diff-btn" data-diff="easy">–õ–µ–≥–∫–æ</button>
<button class="diff-btn active" data-diff="medium">–°—Ä–µ–¥–Ω–µ</button>
<button class="diff-btn" data-diff="hard">–°–ª–æ–∂–Ω–æ</button>
</div>
<div class="theme-grid">
<div class="theme-card" data-theme="tiktok">
<i class="fab fa-tiktok theme-icon"></i>
<div class="theme-title">TikTok</div>
<div class="theme-desc">–¢—Ä–µ–Ω–¥—ã –∏ —á–µ–ª–ª–µ–Ω–¥–∂–∏</div>
</div>
<div class="theme-card" data-theme="memes">
<i class="fas fa-laugh-squint theme-icon"></i>
<div class="theme-title">–ú–µ–º—ã</div>
<div class="theme-desc">–í–∏—Ä—É—Å–Ω—ã–µ —à—É—Ç–∫–∏</div>
</div>
<div class="theme-card" data-theme="music">
<i class="fas fa-music theme-icon"></i>
<div class="theme-title">–ú—É–∑—ã–∫–∞</div>
<div class="theme-desc">–•–∏—Ç—ã –∏ –∞—Ä—Ç–∏—Å—Ç—ã</div>
</div>
<div class="theme-card" data-theme="slang">
<i class="fas fa-comment-dots theme-icon"></i>
<div class="theme-title">–°–ª–µ–Ω–≥</div>
<div class="theme-desc">–ö—Ä–∏–Ω–∂, –≤–∞–π–±, —Ä–æ—Ñ–ª</div>
</div>
<div class="theme-card adult" data-theme="dating">
<i class="fas fa-heart theme-icon"></i>
<div class="theme-title">–û—Ç–Ω–æ—à–µ–Ω–∏—è</div>
<div class="theme-desc">–î–µ–π—Ç–∏–Ω–≥ –∏ –ª—é–±–æ–≤—å</div>
</div>
</div>
<!-- Authors Section -->
<div class="authors-section">
<div class="authors-title">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
<div class="author-links">
<a href="https://t.me/crypto_Nit_tg" class="author-link" target="_blank">
<i class="fab fa-telegram"></i> @crypto_Nit_tg
</a>
<a href="https://t.me/opiumcartidemons" class="author-link" target="_blank">
<i class="fab fa-telegram"></i> @opiumcartidemons
</a>
</div>
</div>
</div>
<!-- Age Check Screen -->
<div class="container screen" id="screen-age">
<div class="header">
<h1><i class="fas fa-user-lock"></i> 18+</h1>
<p>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç</p>
</div>
<div style="padding: 40px 24px; text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: center;">
<div style="font-size: 72px; margin: 24px 0; color: var(--danger);">
<i class="fas fa-user-secret"></i>
</div>
<h2 style="font-size: 26px; margin-bottom: 20px; font-weight: 800;">–¢–æ–ª—å–∫–æ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö</h2>
<p style="color: var(--text-gray); line-height: 1.7; margin-bottom: 36px; font-size: 16px; opacity: 0.9;">
–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Ç–µ—Ä–∏–∞–ª—ã,<br>–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–∏—Ü<br>
<strong>—Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç</strong>.
</p>
<div style="display: flex; flex-direction: column; gap: 16px;">
<button class="btn-control primary" id="btn-age-yes" style="padding: 18px;">
<i class="fas fa-check"></i> –ú–Ω–µ –µ—Å—Ç—å 18
</button>
<button class="btn-control" id="btn-age-no" style="padding: 18px; background: linear-gradient(135deg, var(--danger), #dc2626);">
<i class="fas fa-times"></i> –ú–Ω–µ –Ω–µ—Ç 18
</button>
</div>
</div>
</div>
<!-- Game Screen -->
<div class="container screen" id="screen-game">
<div class="game-header">
<div id="game-title">TikTok</div>
<div class="timer-box" id="timer">30</div>
</div>
<div class="stats-row">
<div class="stat">
<div class="stat-value" id="score">0</div>
<div>–û—á–∫–∏</div>
</div>
<div class="stat">
<div class="stat-value" id="coins">100</div>
<div>–ú–æ–Ω–µ—Ç—ã</div>
</div>
<div class="stat">
<div class="stat-value" id="current-q">1</div>
<div>–í–æ–ø—Ä–æ—Å</div>
</div>
</div>
<div class="progress-container">
<div class="progress-fill" id="progress-bar" style="width: 0%"></div>
</div>
<div class="card-area">
<div class="card">
<div class="card-category" id="card-category">TikTok</div>
<div class="card-question" id="card-question">–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–µ–Ω–¥ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ç–∞–Ω—Ü–µ–º?</div>
</div>
</div>
<div class="answer-buttons">
<button class="btn-answer correct" id="btn-correct">
<i class="fas fa-check"></i> –ü—Ä–∞–≤–∏–ª—å–Ω–æ
</button>
<button class="btn-answer incorrect" id="btn-incorrect">
<i class="fas fa-times"></i> –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
</button>
</div>
<div class="controls">
<button class="btn-control" id="btn-prev">
<i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
</button>
<button class="btn-control primary" id="btn-next">
–í–ø–µ—Ä–µ–¥ <i class="fas fa-arrow-right"></i>
</button>
</div>
</div>
<!-- Results Screen -->
<div class="container screen" id="screen-result">
<div class="header">
<h1><i class="fas fa-trophy"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h1>
<p>–¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
</div>
<div class="result-container">
<div class="result-icon" id="result-icon">üèÜ</div>
<h2 class="result-title" id="result-title">–û—Ç–ª–∏—á–Ω–∞—è –∏–≥—Ä–∞!</h2>
<div class="rating-badge" id="rating-badge">–•–æ—Ä–æ—à–æ</div>
<div class="result-stats">
<div class="stat-box">
<div class="stat-box-value" id="final-score">0</div>
<div class="stat-box-label">–û—á–∫–∏</div>
</div>
<div class="stat-box">
<div class="stat-box-value" id="final-accuracy">0%</div>
<div class="stat-box-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
</div>
<div class="stat-box">
<div class="stat-box-value" id="final-correct">0/5</div>
<div class="stat-box-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
</div>
<div class="stat-box">
<div class="stat-box-value" id="final-time">0—Å</div>
<div class="stat-box-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
</div>
</div>
<div style="margin-top: 28px; width: 100%; display: flex; flex-direction: column; gap: 16px;">
<button class="btn-control primary" id="btn-replay" style="padding: 18px;">
<i class="fas fa-redo"></i> –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
</button>
<button class="btn-control" id="btn-change-theme" style="padding: 18px;">
<i class="fas fa-sync-alt"></i> –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É
</button>
<button class="btn-control" style="background: linear-gradient(135deg, var(--success), #16a34a); padding: 18px;" id="btn-share-result">
<i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
</button>
</div>
<!-- Authors Section in Results -->
<div class="authors-section" style="margin-top: 28px; padding: 20px;">
<div class="authors-title">–°–æ–∑–¥–∞–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏</div>
<div class="author-links">
<a href="https://t.me/crypto_Nit_tg" class="author-link" target="_blank">
<i class="fab fa-telegram"></i> @crypto_Nit_tg
</a>
<a href="https://t.me/opiumcartidemons" class="author-link" target="_blank">
<i class="fab fa-telegram"></i> @opiumcartidemons
</a>
</div>
</div>
</div>
</div>
<script>
// ==================== –®–ê–ë–õ–û–ù–´ –í–û–ü–†–û–°–û–í ====================
const QUESTION_TEMPLATES = {
tiktok: [
{ q: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç—Ä–µ–Ω–¥, –≥–¥–µ –≤—Å–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–∞–Ω–µ—Ü –ø–æ–¥ –ø–µ—Å–Ω—é '{{song}}'?", a: "–ß–µ–ª–ª–µ–Ω–¥–∂" },
{ q: "–ö—Ç–æ –∏–∑ —ç—Ç–∏—Ö –±–ª–æ–≥–µ—Ä–æ–≤ —Å—Ç–∞–ª –≤–∏—Ä—É—Å–Ω—ã–º –±–ª–∞–≥–æ–¥–∞—Ä—è —á–µ–ª–ª–µ–Ω–¥–∂—É '{{challenge}}'?", a: "{{creator}}" },
{ q: "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ç–µ—Ä–º–∏–Ω '—Å–∏–≥–º–∞' –≤ TikTok-–∫—É–ª—å—Ç—É—Ä–µ?", a: "–¢–∏–ø –º—É–∂—á–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–≤–∏—Ç —Ü–µ–ª–∏ –≤—ã—à–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–π" },
{ q: "–ö–∞–∫–æ–π —Ç—Ä–µ–Ω–¥ —Å—Ç–∞–ª –º–µ–º–æ–º –ø–æ—Å–ª–µ –≤–∏–¥–µ–æ —Å '{{memeSubject}}'?", a: "{{trendName}}" },
{ q: "–û—Ç–∫—É–¥–∞ –ø–æ—à—ë–ª –º–µ–º '–æ–∫–µ–π, –±—É–º–µ—Ä'?", a: "–ò–∑ TikTok –∫–∞–∫ –æ—Ç–≤–µ—Ç —Å—Ç–∞—Ä—à–µ–º—É –ø–æ–∫–æ–ª–µ–Ω–∏—é" }
],
memes: [
{ q: "–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Å–ª–æ–≤–æ '–∫—Ä–∏–Ω–∂' –≤ –∑—É–º–µ—Ä—Å–∫–æ–º —Å–ª–µ–Ω–≥–µ?", a: "–°–∏–ª—å–Ω–æ–µ —á—É–≤—Å—Ç–≤–æ —Å—Ç—ã–¥–∞ –∑–∞ –∫–æ–≥–æ-—Ç–æ" },
{ q: "–ö—Ç–æ —Ç–∞–∫–æ–π '—á–µ–ª' –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫—É–ª—å—Ç—É—Ä–µ?", a: "–ü–∞—Ä–µ–Ω—å, –º—É–∂—á–∏–Ω–∞ (–æ—Ç —Å–ª–æ–≤–∞ '—á–µ–ª–æ–≤–µ–∫')" },
{ q: "–ß—Ç–æ –∑–Ω–∞—á–∏—Ç '—Ñ–ª–µ–∫—Å–∏—Ç—å'?", a: "–•–≤–∞—Å—Ç–∞—Ç—å—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å" },
{ q: "–ö–∞–∫–æ–π –º–µ–º —Å –∫–æ—Ç–∏–∫–æ–º —Å—Ç–∞–ª –≤–∏—Ä—É—Å–Ω—ã–º –≤ 2023 –≥–æ–¥—É?", a: "{{catMeme}}" },
{ q: "–û—Ç–∫—É–¥–∞ –ø–æ—à—ë–ª –º–µ–º '{{randomMeme}}'?", a: "–ò–∑ TikTok/Reddit –≤ 2022-2023" }
],
music: [
{ q: "–ö—Ç–æ –∏—Å–ø–æ–ª–Ω–∏–ª —Ç—Ä–µ–∫ '{{song}}', —Å—Ç–∞–≤—à–∏–π –≤–∏—Ä—É—Å–Ω—ã–º –≤ TikTok?", a: "{{artist}}" },
{ q: "–ö–∞–∫–æ–π —Ä—É—Å—Å–∫–∏–π —Ä—ç–ø–µ—Ä –≤—ã–ø—É—Å—Ç–∏–ª —Ç—Ä–µ–∫ '{{track}}'?", a: "MORGENSHTERN" },
{ q: "–ß—Ç–æ —Ç–∞–∫–æ–µ 'phonk' –≤ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –∫—É–ª—å—Ç—É—Ä–µ?", a: "–ñ–∞–Ω—Ä —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏ —Å –º–µ–º—Ñ–∏—Å-—Ä—ç–ø —Å–µ–º–ø–ª–∞–º–∏" },
{ q: "–ò–∑ –∫–∞–∫–æ–π –ø–µ—Å–Ω–∏ —Å—Ç—Ä–æ—á–∫–∞: '{{lyric}}'?", a: "{{artist}} - {{song}}" },
{ q: "–ö–∞–∫–æ–π —Ç—Ä–µ–∫ –¥–æ–ª—å—à–µ –≤—Å–µ–≥–æ –±—ã–ª –≤ —Ç—Ä–µ–Ω–¥–µ TikTok –≤ 2023?", a: "Dreams - Fleetwood Mac" }
],
slang: [
{ q: "–ß—Ç–æ –∑–Ω–∞—á–∏—Ç '–≤–∞–π–±'?", a: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —ç–Ω–µ—Ä–≥–∏—è" },
{ q: "–ß—Ç–æ —Ç–∞–∫–æ–µ '—á–∏–ª–∏—Ç—å'?", a: "–†–∞—Å—Å–ª–∞–±–ª—è—Ç—å—Å—è, –æ—Ç–¥—ã—Ö–∞—Ç—å (–æ—Ç –∞–Ω–≥–ª. chill)" },
{ q: "–ß—Ç–æ –∑–Ω–∞—á–∏—Ç '–≥–æ'?", a: "–ü–æ–π–¥–µ–º, –¥–∞–≤–∞–π (–æ—Ç –∞–Ω–≥–ª. go)" },
{ q: "–ö—Ç–æ —Ç–∞–∫–æ–π '—Å–∏–º–ø'?", a: "–ü–∞—Ä–µ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è —É–¥–µ–ª—è–µ—Ç –¥–µ–≤—É—à–∫–µ" },
{ q: "–ß—Ç–æ –∑–Ω–∞—á–∏—Ç '–ê–£–§'?", a: "–í–æ—Å–∫–ª–∏—Ü–∞–Ω–∏–µ, –≤—ã—Ä–∞–∂–∞—é—â–µ–µ —É–¥–∏–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ" }
],
dating: [
{ q: "–ß—Ç–æ —Ç–∞–∫–æ–µ 'ghosting' –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö?", a: "–†–µ–∑–∫–æ–µ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –æ–±—â–µ–Ω–∏—è –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π" },
{ q: "–ß—Ç–æ –∑–Ω–∞—á–∏—Ç 'situationship'?", a: "–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤" },
{ q: "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–≤–∏–¥–∞–Ω–∏–µ –≤—Å–ª–µ–ø—É—é —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?", a: "Blind date —á–µ—Ä–µ–∑ Tinder/Bumble" },
{ q: "–ß—Ç–æ —Ç–∞–∫–æ–µ 'soft launching' –æ—Ç–Ω–æ—à–µ–Ω–∏–π?", a: "–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö" },
{ q: "–ö–∞–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤ —Å–∞–º–æ–µ –ø–æ–ø—É–ª—è—Ä–Ω–æ–µ —É –∑—É–º–µ—Ä–æ–≤?", a: "Tinder" }
]
};
// ==================== –î–ê–ù–ù–´–ï –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò ====================
const DYNAMIC_DATA = {
songs: ["Murder on My Mind", "INDUSTRY BABY", "As It Was", "Flowers", "Kill Bill"],
artists: ["YNW Melly", "Lil Nas X", "Harry Styles", "Miley Cyrus", "SZA"],
creators: ["–î–∞–≤–∞", "–ù–∞—Å—Ç—è –ò–≤–ª–µ–µ–≤–∞", "–≠–¥–≤–∞—Ä–¥ –ú–æ—Ä–≥–∞–Ω", "–ú–∞—à–∞ –•–º–µ–ª—å", "–ê—Ä—Ç—É—Ä –ë–∞–±–∏—á"],
challenges: ["Buss It Challenge", "Silhouette Challenge", "Point of View", "Get Ready With Me"],
memeSubjects: ["—Ç–∞–Ω—Ü—É—é—â–∏–π –ø—ë—Å", "–ø–ª–∞—á—É—â–∏–π —Ä–µ–±—ë–Ω–æ–∫", "—É–¥–∏–≤–ª—ë–Ω–Ω–∞—è –±–∞–±—É—à–∫–∞", "–∫–æ—Ç –≤ –æ—á–∫–∞—Ö"],
trendNames: ["Silhouette", "POV", "GRWM", "Sigma Walk"],
catMemes: ["Grumpy Cat", "I Can Has Cheezburger?", "Nyan Cat", "Keyboard Cat"],
randomMemes: ["How it started vs How it's going", "Woman Yelling at a Cat", "Distracted Boyfriend", "This is Fine"]
};

// ==================== –î–ï–¢–ï–†–ú–ò–ù–ò–†–û–í–ê–ù–ù–´–ô –ì–ï–ù–ï–†–ê–¢–û–† ====================
function seededRandom(seed) {
  let s = seed;
  return function() {
    s = Math.sin(s) * 10000;
    return s - Math.floor(s);
  };
}

function generateQuestionsForTheme(theme, count = 5, seed = null) {
  const templates = QUESTION_TEMPLATES[theme];
  if (!templates) return [];
  
  const random = seed ? seededRandom(seed) : Math.random;
  const questions = [];
  const usedIndices = new Set();
  
  for (let i = 0; i < Math.min(count, templates.length); i++) {
    let index;
    do {
      index = Math.floor(random() * templates.length);
    } while (usedIndices.has(index) && usedIndices.size < templates.length);
    usedIndices.add(index);
    const template = templates[index];
    
    let question = template.q;
    let answer = template.a;
    
    // –ó–∞–º–µ–Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ —Å —É—á—ë—Ç–æ–º seed
    const replacePlaceholder = (str, key, arr) => {
      const item = arr[Math.floor(random() * arr.length)];
      return str.replace(new RegExp(`{{${key}}}`, 'g'), item);
    };
    
    question = replacePlaceholder(question, 'song', DYNAMIC_DATA.songs);
    question = replacePlaceholder(question, 'artist', DYNAMIC_DATA.artists);
    question = replacePlaceholder(question, 'creator', DYNAMIC_DATA.creators);
    question = replacePlaceholder(question, 'challenge', DYNAMIC_DATA.challenges);
    question = replacePlaceholder(question, 'memeSubject', DYNAMIC_DATA.memeSubjects);
    question = replacePlaceholder(question, 'trendName', DYNAMIC_DATA.trendNames);
    question = replacePlaceholder(question, 'catMeme', DYNAMIC_DATA.catMemes);
    question = replacePlaceholder(question, 'randomMeme', DYNAMIC_DATA.randomMemes);
    question = replacePlaceholder(question, 'track', DYNAMIC_DATA.songs);
    
    if (question.includes('{{lyric}}')) {
      const lyrics = ["–≠—Ç–æ –∂–µ—Å—Ç—å, —ç—Ç–æ –¥–∏—á—å", "–Ø –Ω–µ —Ç–≤–æ—è, –Ω–æ —Ç—ã –º–æ–π", "–ì–¥–µ –º–æ–∏ –¥–µ–Ω—å–≥–∏, –õ–µ–±—Ä–æ–Ω?", "–°–∏–≥–º–∞ —à–∞–≥–∞–µ—Ç –ø–æ –≥–æ—Ä–æ–¥—É"];
      const lyric = `"${lyrics[Math.floor(random() * lyrics.length)]}"`;
      question = question.replace(/{{lyric}}/g, lyric);
    }
    
    answer = replacePlaceholder(answer, 'artist', DYNAMIC_DATA.artists);
    answer = replacePlaceholder(answer, 'song', DYNAMIC_DATA.songs);
    
    questions.push({
      category: getThemeCategory(theme),
      question: question,
      answer: answer,
      isCorrect: true
    });
  }
  return questions;
}

function getThemeCategory(theme) {
  const map = {
    tiktok: "TikTok",
    memes: "–ú–µ–º—ã",
    music: "–ú—É–∑—ã–∫–∞",
    slang: "–°–ª–µ–Ω–≥",
    dating: "–î–µ–π—Ç–∏–Ω–≥"
  };
  return map[theme] || "–í–æ–ø—Ä–æ—Å";
}

// Config
const GAME_CONFIG = {
  timePerQuestion: 30,
  basePoints: 10,
  coinsPerCorrect: 5,
  dailyBonus: 50,
  levelUpThreshold: 100
};
const adultThemes = ['dating'];

// State
let currentTheme = '';
let currentCards = [];
let currentCardIndex = 0;
let score = 0;
let correctCount = 0;
let playerCoins = 100;
let timer = null;
let timeLeft = GAME_CONFIG.timePerQuestion;
let difficulty = 'medium';
let soundEnabled = true;
let playerName = '–ó—É–º–µ—Ä';
let playerAvatar = 'üß†';
let playerLevel = 1;
let currentStreak = 0;
let maxStreak = 0;
let totalGames = 0;
let favoriteThemes = ['tiktok', 'memes'];
let selectedTheme = 'default';
let isTelegramPremium = false;
let telegramUserId = null;
let telegramUsername = null;
let telegramPhotoUrl = null;
let recognition = null;
let isListening = false;

// === MULTIPLAYER STATE ===
let multiplayerRoom = null;
let isInDuel = false;

// Mock leaderboard data
const mockLeaderboard = [
  { rank: 1, name: 'CryptoNit', avatar: 'üëë', score: 1250, userId: 'user1' },
  { rank: 2, name: 'OpiumDemon', avatar: 'üíé', score: 1180, userId: 'user2' },
  { rank: 3, name: 'VibeMaster', avatar: 'üî•', score: 1050, userId: 'user3' },
  { rank: 4, name: 'TikTokKing', avatar: 'üòé', score: 980, userId: 'user4' },
  { rank: 5, name: 'MemeLord', avatar: 'üòÇ', score: 920, userId: 'user5' }
];

// DOM Elements
const screens = {
  theme: document.getElementById('screen-theme'),
  age: document.getElementById('screen-age'),
  game: document.getElementById('screen-game'),
  result: document.getElementById('screen-result')
};

// Init
document.addEventListener('DOMContentLoaded', () => {
  // === –û–±—Ä–∞–±–æ—Ç–∫–∞ URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥—É—ç–ª–∏ ===
  const urlParams = new URLSearchParams(window.location.search);
  const duelId = urlParams.get('duel');
  if (duelId) {
    multiplayerRoom = duelId;
    isInDuel = true;
    setTimeout(() => {
      showNotification(`üéÆ –í—ã –≤ –¥—É—ç–ª–∏! –ò–≥—Ä–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ!`, "success");
    }, 1000);
  }

  initTelegramIntegration();
  setupEventListeners();
  loadProgress();
  checkDailyBonus();
  updateProfileDisplay();
  populateLeaderboard();
  setupScrollIndicator();
});

function initTelegramIntegration() {
  if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    const tg = Telegram.WebApp;
    tg.expand();
    if (tg.initDataUnsafe.user) {
      const user = tg.initDataUnsafe.user;
      telegramUserId = user.id;
      telegramUsername = user.username || user.first_name;
      telegramPhotoUrl = user.photo_url;
      playerName = user.first_name || '–ó—É–º–µ—Ä';
      if (user.last_name) playerName += ' ' + user.last_name;
      isTelegramPremium = user.is_premium || false;
      updateProfileDisplay();
    }
    tg.MainButton.setText("–ó–∞–∫—Ä—ã—Ç—å");
    tg.MainButton.onClick(() => tg.close());
  }
}

function setupEventListeners() {
  // Ripple effect with touch support
  document.querySelectorAll('button, .icon-btn, .author-link, .theme-card').forEach(el => {
    el.addEventListener('touchstart', function(e) {
      e.preventDefault();
      const rect = this.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      const y = e.touches[0].clientY - rect.top;
      const ripple = document.createElement('span');
      ripple.classList.add('ripple');
      ripple.style.left = `${x}px`;
      ripple.style.top = `${y}px`;
      this.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
      if ('vibrate' in navigator) navigator.vibrate(10);
    }, { passive: false });
    
    // Fallback for non-touch devices
    el.addEventListener('click', function(e) {
      // Prevent double execution on touch devices
      if (window.TouchEvent && e instanceof TouchEvent) return;
      // Your click logic is handled by touchstart above
    });
  });

  // Theme selection
  document.querySelectorAll('.theme-card').forEach(card => {
    card.addEventListener('touchend', (e) => {
      e.preventDefault();
      const theme = card.dataset.theme;
      selectTheme(theme);
    });
  });

  // Study mode
  document.querySelectorAll('[data-study]').forEach(card => {
    card.addEventListener('touchend', (e) => {
      e.preventDefault();
      const theme = card.dataset.study;
      startStudyMode(theme);
    });
  });

  // Difficulty
  document.querySelectorAll('.diff-btn').forEach(btn => {
    btn.addEventListener('touchend', (e) => {
      e.preventDefault();
      document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      difficulty = btn.dataset.diff;
      updateDifficulty();
    });
  });

  // Age check
  const btnAgeYes = document.getElementById('btn-age-yes');
  const btnAgeNo = document.getElementById('btn-age-no');
  if (btnAgeYes) {
    btnAgeYes.addEventListener('touchend', (e) => { e.preventDefault(); startGame(); });
  }
  if (btnAgeNo) {
    btnAgeNo.addEventListener('touchend', (e) => { e.preventDefault(); showScreen('theme'); });
  }

  // Game controls
  const btnCorrect = document.getElementById('btn-correct');
  const btnIncorrect = document.getElementById('btn-incorrect');
  const btnNext = document.getElementById('btn-next');
  const btnPrev = document.getElementById('btn-prev');
  if (btnCorrect) btnCorrect.addEventListener('touchend', (e) => { e.preventDefault(); checkAnswer(true); });
  if (btnIncorrect) btnIncorrect.addEventListener('touchend', (e) => { e.preventDefault(); checkAnswer(false); });
  if (btnNext) btnNext.addEventListener('touchend', (e) => { e.preventDefault(); nextQuestion(); });
  if (btnPrev) btnPrev.addEventListener('touchend', (e) => { e.preventDefault(); prevQuestion(); });

  // Results
  const btnReplay = document.getElementById('btn-replay');
  const btnChangeTheme = document.getElementById('btn-change-theme');
  const btnShareResult = document.getElementById('btn-share-result');
  if (btnReplay) btnReplay.addEventListener('touchend', (e) => { e.preventDefault(); startGame(); });
  if (btnChangeTheme) btnChangeTheme.addEventListener('touchend', (e) => { e.preventDefault(); showScreen('theme'); });
  if (btnShareResult) btnShareResult.addEventListener('touchend', (e) => { e.preventDefault(); showShareModal(); });

  // Modals
  const achievementsToggle = document.getElementById('achievements-toggle');
  const closeAchievements = document.getElementById('close-achievements');
  const leaderboardToggle = document.getElementById('leaderboard-toggle');
  const closeLeaderboard = document.getElementById('close-leaderboard');
  const profileToggle = document.getElementById('profile-toggle');
  const closeProfile = document.getElementById('close-profile');
  const openMultiplayer = document.getElementById('open-multiplayer');
  const closeMultiplayer = document.getElementById('close-multiplayer');
  const duelBtn = document.getElementById('duel-btn');
  const openStudy = document.getElementById('open-study');
  const closeStudy = document.getElementById('close-study');
  const closeShare = document.getElementById('close-share');
  const shareToTelegram = document.getElementById('share-to-telegram');
  const soundToggle = document.getElementById('sound-toggle');
  const copyLinkBtn = document.getElementById('copy-link-btn');
  const closeInvite = document.getElementById('close-invite');

  if (achievementsToggle) achievementsToggle.addEventListener('touchend', (e) => { e.preventDefault(); toggleAchievements(); });
  if (closeAchievements) closeAchievements.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('achievements-modal')?.classList.remove('active'); });
  if (leaderboardToggle) leaderboardToggle.addEventListener('touchend', (e) => { e.preventDefault(); toggleLeaderboard(); });
  if (closeLeaderboard) closeLeaderboard.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('leaderboard-modal')?.classList.remove('active'); });
  if (profileToggle) profileToggle.addEventListener('touchend', (e) => { e.preventDefault(); toggleProfile(); });
  if (closeProfile) closeProfile.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('profile-modal')?.classList.remove('active'); });
  if (openMultiplayer) openMultiplayer.addEventListener('touchend', (e) => { e.preventDefault(); toggleMultiplayer(); });
  if (closeMultiplayer) closeMultiplayer.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('multiplayer-modal')?.classList.remove('active'); });
  if (duelBtn) duelBtn.addEventListener('touchend', (e) => { e.preventDefault(); startDuel(); });
  if (openStudy) openStudy.addEventListener('touchend', (e) => { e.preventDefault(); toggleStudyMode(); });
  if (closeStudy) closeStudy.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('study-modal')?.classList.remove('active'); });
  if (closeShare) closeShare.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('share-modal')?.classList.remove('active'); });
  if (shareToTelegram) shareToTelegram.addEventListener('touchend', (e) => { e.preventDefault(); shareToTelegramHandler(); });
  if (soundToggle) soundToggle.addEventListener('touchend', (e) => { e.preventDefault(); toggleSound(); });
  if (copyLinkBtn) copyLinkBtn.addEventListener('touchend', (e) => { e.preventDefault(); copyInviteLink(); });
  if (closeInvite) closeInvite.addEventListener('touchend', (e) => { e.preventDefault(); document.getElementById('invite-modal')?.classList.remove('active'); });

  // Handle scroll
  const screenTheme = document.getElementById('screen-theme');
  if (screenTheme) {
    screenTheme.addEventListener('scroll', handleScroll);
  }
}

function handleScroll() {
  const screen = document.getElementById('screen-theme');
  const scrollIndicator = document.getElementById('scroll-indicator');
  if (!screen || !scrollIndicator) return;
  const isAtBottom = screen.scrollHeight - screen.scrollTop <= screen.clientHeight + 10;
  scrollIndicator.style.display = isAtBottom ? 'none' : 'flex';
}

function setupScrollIndicator() {
  const screen = document.getElementById('screen-theme');
  const scrollIndicator = document.getElementById('scroll-indicator');
  if (!screen || !scrollIndicator) return;
  setTimeout(() => {
    if (screen.scrollHeight <= screen.clientHeight) {
      scrollIndicator.style.display = 'none';
    }
  }, 5000);
}

function showScreen(screenName) {
  Object.keys(screens).forEach(key => {
    const el = screens[key];
    if (el) el.classList.remove('active');
  });
  const target = screens[screenName];
  if (target) target.classList.add('active');
  const scrollIndicator = document.getElementById('scroll-indicator');
  if (scrollIndicator) scrollIndicator.style.display = 'none';
}

function selectTheme(theme) {
  currentTheme = theme;
  if (adultThemes.includes(theme)) {
    const warning = document.getElementById('age-warning');
    if (warning) {
      warning.classList.add('show');
      setTimeout(() => {
        showScreen('age');
        if (warning) warning.classList.remove('show');
      }, 1500);
    }
  } else {
    startGame();
  }
}

function startStudyMode(theme) {
  currentTheme = theme;
  currentCards = generateQuestionsForTheme(currentTheme, 5);
  currentCardIndex = 0;
  showScreen('game');
  updateCard();
  const timerEl = document.getElementById('timer');
  if (timerEl) timerEl.textContent = "‚àû";
  const gameTitle = document.getElementById('game-title');
  if (gameTitle) gameTitle.textContent = `üìö ${theme} (–û–±—É—á–µ–Ω–∏–µ)`;
}

function updateDifficulty() {
  switch(difficulty) {
    case 'easy':
      GAME_CONFIG.timePerQuestion = 45;
      GAME_CONFIG.basePoints = 15;
      break;
    case 'medium':
      GAME_CONFIG.timePerQuestion = 30;
      GAME_CONFIG.basePoints = 10;
      break;
    case 'hard':
      GAME_CONFIG.timePerQuestion = 15;
      GAME_CONFIG.basePoints = 20;
      break;
  }
}

// === –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–£–°–ö–ê –ò–ì–†–´ ===
function startGame() {
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º seed –∏–∑ –∫–æ–º–Ω–∞—Ç—ã –∏–ª–∏ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
  const seed = multiplayerRoom ? parseInt(multiplayerRoom, 36) : Date.now();

  currentCards = generateQuestionsForTheme(currentTheme, 5, seed);
  totalQuestions = currentCards.length;
  currentCardIndex = 0;
  score = 0;
  correctCount = 0;
  currentStreak = 0;

  const themeNames = {
    'tiktok': 'üì± TikTok & Reels',
    'memes': 'üòÇ –ú–µ–º—ã & –ò–Ω—Ç–µ—Ä–Ω–µ—Ç',
    'music': 'üéµ –ú—É–∑—ã–∫–∞',
    'slang': 'üí¨ –ó—É–º–µ—Ä—Å–∫–∏–π —Å–ª–µ–Ω–≥',
    'dating': '‚ù§Ô∏è‚Äçüî• –û—Ç–Ω–æ—à–µ–Ω–∏—è 18+'
  };

  const gameTitle = document.getElementById('game-title');
  if (gameTitle) {
    gameTitle.textContent = themeNames[currentTheme] || 'ZUMER BRAIN';
  }
  showScreen('game');
  updateCard();
  updateStats();
  startTimer();

  const msg = isInDuel 
    ? "üéÆ –î—É—ç–ª—å –Ω–∞—á–∞–ª–∞—Å—å! –£–¥–∞—á–∏!" 
    : "–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –£–¥–∞—á–∏!";
  showNotification(msg, "success");
}

function updateCard() {
  if (currentCardIndex >= currentCards.length) return;
  const card = currentCards[currentCardIndex];
  const categoryEl = document.getElementById('card-category');
  const questionEl = document.getElementById('card-question');
  const currentQEl = document.getElementById('current-q');
  const progressEl = document.getElementById('progress-bar');
  
  if (categoryEl) categoryEl.textContent = card.category;
  if (questionEl) questionEl.textContent = card.question;
  if (currentQEl) currentQEl.textContent = currentCardIndex + 1;
  if (progressEl) {
    const progress = ((currentCardIndex + 1) / currentCards.length) * 100;
    progressEl.style.width = `${progress}%`;
  }
}

function updateStats() {
  const scoreEl = document.getElementById('score');
  const coinsEl = document.getElementById('coins');
  if (scoreEl) scoreEl.textContent = score;
  if (coinsEl) coinsEl.textContent = playerCoins;
}

function startTimer() {
  clearInterval(timer);
  timeLeft = GAME_CONFIG.timePerQuestion;
  const timerEl = document.getElementById('timer');
  if (timerEl) timerEl.textContent = timeLeft;
  timer = setInterval(() => {
    timeLeft--;
    if (timerEl) timerEl.textContent = timeLeft;
    if (timeLeft <= 0) {
      clearInterval(timer);
      showNotification("–í—Ä–µ–º—è –≤—ã—à–ª–æ! ‚è∞", "warning");
      nextQuestion();
    }
  }, 1000);
}

function checkAnswer(isCorrect) {
  clearInterval(timer);
  const card = currentCards[currentCardIndex];
  if (isCorrect === card.isCorrect) {
    const points = GAME_CONFIG.basePoints;
    score += points;
    correctCount++;
    currentStreak++;
    maxStreak = Math.max(maxStreak, currentStreak);
    playerCoins += GAME_CONFIG.coinsPerCorrect;
    showNotification(`‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! +${points} –æ—á–∫–æ–≤`, "success");
    createConfetti();
  } else {
    currentStreak = 0;
    showNotification("‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!", "error");
  }
  updateStats();
}

function nextQuestion() {
  currentCardIndex++;
  if (currentCardIndex < currentCards.length) {
    updateCard();
    startTimer();
  } else {
    finishGame();
  }
}

function prevQuestion() {
  if (currentCardIndex > 0) {
    currentCardIndex--;
    updateCard();
    startTimer();
  }
}

function finishGame() {
  totalGames++;
  const accuracy = currentCards.length > 0 ? Math.round((correctCount / currentCards.length) * 100) : 0;

  if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    Telegram.WebApp.sendData(JSON.stringify({
      action: 'game_result',
      score: score,
      accuracy: accuracy,
      correctCount: correctCount,
      totalQuestions: currentCards.length,
      theme: currentTheme
    }));
  }

  document.getElementById('final-score').textContent = score;
  document.getElementById('final-accuracy').textContent = `${accuracy}%`;
  document.getElementById('final-correct').textContent = `${correctCount}/${currentCards.length}`;
  document.getElementById('final-time').textContent = "15—Å";

  let rating = "–•–æ—Ä–æ—à–æ", icon = "üëç";
  if (accuracy >= 90) { rating = "–û—Ç–ª–∏—á–Ω–æ!"; icon = "üèÜ"; }
  else if (accuracy >= 70) { rating = "–•–æ—Ä–æ—à–æ"; icon = "üëç"; }
  else if (accuracy >= 50) { rating = "–ù–µ–ø–ª–æ—Ö–æ"; icon = "üòä"; }
  else { rating = "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ"; icon = "üí™"; }

  document.getElementById('result-icon').textContent = icon;
  document.getElementById('result-title').textContent = accuracy >= 70 ? "–û—Ç–ª–∏—á–Ω–∞—è –∏–≥—Ä–∞!" : "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ!";
  document.getElementById('rating-badge').textContent = rating;

  if (accuracy > 80) {
    favoriteThemes.push(currentTheme);
    favoriteThemes = [...new Set(favoriteThemes)].slice(-3);
  }

  const xpGained = score / 10;
  if (xpGained >= GAME_CONFIG.levelUpThreshold) {
    playerLevel++;
    showNotification(`üéâ –£—Ä–æ–≤–µ–Ω—å UP! –¢–µ–ø–µ—Ä—å ${playerLevel} —É—Ä–æ–≤–µ–Ω—å!`, "success");
  }

  showScreen('result');
  updateProfileDisplay();
  saveProgress();
}

function showNotification(message, type = "info") {
  const notif = document.getElementById('notification');
  if (!notif) return;
  notif.textContent = message;
  notif.className = `notification ${type} show`;
  setTimeout(() => notif.classList.remove('show'), 2500);
}

// === –ú–£–õ–¨–¢–ò–ü–õ–ï–ï–† ===
function startDuel() {
  if (isInDuel) {
    showNotification("–í—ã —É–∂–µ –≤ –¥—É—ç–ª–∏!", "warning");
    return;
  }

  const roomId = Math.random().toString(36).substring(2, 10);
  const inviteLink = `${window.location.origin}${window.location.pathname}?duel=${roomId}`;

  const input = document.getElementById('invite-input');
  const modal = document.getElementById('invite-modal');
  if (input) input.value = inviteLink;
  if (modal) modal.classList.add('active');

  multiplayerRoom = roomId;
  isInDuel = true;
}

// === –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
function toggleAchievements() {
  document.getElementById('achievements-modal')?.classList.add('active');
  document.getElementById('achievements-list').innerHTML = `
  <div style="padding: 16px; background: rgba(255,255,255,0.08); border-radius: 16px; margin: 12px 0; border: 1px solid rgba(255,255,255,0.1);">
    <div style="font-weight: 700; margin-bottom: 8px;">–ü–µ—Ä–≤—ã–π —Ñ–ª–µ–∫—Å</div>
    <div style="font-size: 13px; color: var(--text-gray);">–ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å</div>
  </div>
  <div style="padding: 16px; background: rgba(255,255,255,0.08); border-radius: 16px; margin: 12px 0; border: 1px solid rgba(255,255,255,0.1); opacity: 0.5;">
    <div style="font-weight: 700; margin-bottom: 8px;">–ö—Ä–∏–Ω–∂–æ–≤—ã–π —Å—Ç—Ä–∏–∫</div>
    <div style="font-size: 13px; color: var(--text-gray);">10 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥—Ä—è–¥</div>
  </div>
  `;
}
function toggleLeaderboard() {
  document.getElementById('leaderboard-modal')?.classList.add('active');
}
function toggleProfile() {
  document.getElementById('profile-modal')?.classList.add('active');
}
function showShareModal() {
  document.getElementById('share-modal')?.classList.add('active');
}
function toggleMultiplayer() {
  document.getElementById('multiplayer-modal')?.classList.add('active');
}
function toggleStudyMode() {
  document.getElementById('study-modal')?.classList.add('active');
}
function shareToTelegramHandler() {
  const message = `–Ø –Ω–∞–±—Ä–∞–ª ${score} –æ—á–∫–æ–≤ –≤ ZUMER BRAIN! –ü–æ–ø—Ä–æ–±—É–π –∏ —Ç—ã: https://t.me/vibecards_bot`;
  if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
    Telegram.WebApp.sendData(JSON.stringify({ action: 'share', message: message }));
  }
  showNotification("–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram! üì±", "success");
  document.getElementById('share-modal')?.classList.remove('active');
}
function populateLeaderboard() {
  const leaderboardList = document.getElementById('leaderboard-list');
  if (!leaderboardList) return;
  leaderboardList.innerHTML = mockLeaderboard.map((player, index) => `
  <div style="display: flex; align-items: center; padding: 16px; margin: 12px 0; background: rgba(255,255,255,0.05); border-radius: 18px;">
    <div style="width: 36px; height: 36px; border-radius: 50%; background: ${index < 3 ? 'linear-gradient(135deg, gold, #ff8c00)' : 'var(--primary)'}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 16px; margin-right: 16px;">
      ${player.rank}
    </div>
    <div style="flex: 1; font-weight: 600;">${player.name}</div>
    <div style="font-weight: 800; color: var(--primary);">${player.score}</div>
  </div>
  `).join('');
}
function updateProfileDisplay() {
  const setAvatar = (imgElement, fallbackElement, photoUrl) => {
    if (!imgElement || !fallbackElement) return;
    if (photoUrl) {
      imgElement.src = photoUrl;
      imgElement.style.display = 'block';
      fallbackElement.style.display = 'none';
    } else {
      imgElement.style.display = 'none';
      fallbackElement.style.display = 'block';
    }
  };
  setAvatar(document.getElementById('main-profile-avatar-img'), document.getElementById('main-profile-avatar-fallback'), telegramPhotoUrl);
  document.getElementById('main-profile-name').textContent = playerName;
  document.getElementById('main-profile-level').textContent = playerLevel;
  setAvatar(document.getElementById('profile-avatar-img'), document.getElementById('profile-avatar-fallback'), telegramPhotoUrl);
  document.getElementById('profile-display-name').textContent = playerName;
  document.getElementById('profile-level').textContent = playerLevel;
  document.getElementById('profile-coins').textContent = playerCoins;
  document.getElementById('profile-accuracy').textContent = totalGames > 0 ? '85%' : '0%';
  document.getElementById('profile-streak').textContent = maxStreak;
}
function createConfetti() {
  const container = document.getElementById('confetti-container');
  if (!container) return;
  const colors = ['#6366f1', '#8b5cf6', '#ec4899', '#22c55e', '#f59e0b'];
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + 'vw';
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.animationDelay = Math.random() * 2 + 's';
    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
    container.appendChild(confetti);
    setTimeout(() => confetti.remove(), 5000);
  }
}
function toggleSound() {
  soundEnabled = !soundEnabled;
  const icon = document.querySelector('#sound-toggle i');
  if (icon) {
    icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
  }
  showNotification(soundEnabled ? "üîä –ó–≤—É–∫ –≤–∫–ª—é—á–µ–Ω" : "üîá –ó–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω");
}
function checkDailyBonus() {
  const today = new Date().toDateString();
  const lastDate = localStorage.getItem('lastPlayDate');
  if (lastDate !== today) {
    playerCoins += GAME_CONFIG.dailyBonus;
    localStorage.setItem('lastPlayDate', today);
    showNotification(`üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å! +${GAME_CONFIG.dailyBonus} –º–æ–Ω–µ—Ç`, "success");
  }
}
function saveProgress() {
  const progress = {
    coins: playerCoins,
    level: playerLevel,
    avatar: playerAvatar,
    name: playerName,
    streak: maxStreak,
    games: totalGames,
    favorites: favoriteThemes,
    telegramUserId: telegramUserId,
    telegramUsername: telegramUsername,
    telegramPhotoUrl: telegramPhotoUrl,
    isTelegramPremium: isTelegramPremium
  };
  localStorage.setItem('gameProgress', JSON.stringify(progress));
}
function loadProgress() {
  const saved = localStorage.getItem('gameProgress');
  if (saved) {
    const progress = JSON.parse(saved);
    playerCoins = progress.coins || 100;
    playerLevel = progress.level || 1;
    playerAvatar = progress.avatar || 'üß†';
    playerName = progress.name || '–ó—É–º–µ—Ä';
    maxStreak = progress.streak || 0;
    totalGames = progress.games || 0;
    favoriteThemes = progress.favorites || ['tiktok', 'memes'];
    telegramUserId = progress.telegramUserId || null;
    telegramUsername = progress.telegramUsername || null;
    telegramPhotoUrl = progress.telegramPhotoUrl || null;
    isTelegramPremium = progress.isTelegramPremium || false;
  }
}
</script>
</body>
</html>
